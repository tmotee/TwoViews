Two Views
=========
This is an exercise to check my understanding of photogrammetry concepts and C++ in general. I've implemented something akin to [PMVS2](https://www.di.ens.fr/pmvs/) for the special case of rectified stereo images from the Middlebury Stereo Evaluation dataset. Feel free to reuse this code in any way you want.

Description
-----------
PMVS2 works by triangulating a set of oriented square "patches" in the scene, and iteratively optimizing and expanding them into neighboring regions. The objective function for the optimization step is based on the color difference between views when projecting patches onto each camera, under the assumption that the surfaces in the scene display lambertian reflectance.

My implementation omits many details that I can't remember off the top of my head, taking a simplified approach that handles only two views. Furthermore, it uses camera calibration information in the dataset to skip the well-known calibration and pose estimation step, in order to focus on the reconstruction.

The final reconstruction below was generated from the "Crusade" image pair available [here](https://vision.middlebury.edu/stereo/data/scenes2014/). I've also included the generated point cloud files in the sample/ folder.

![Final reconstruction](/sample/optimized2.png)

For comparison, here is the point cloud generated by the initial feature triangulation, which is noticeably more sparse:

![Initial triangulation](/sample/initial.png)

The effect of the optimization step can be seen in this top view, where the patches are more tightly aligned on a planar surface. These two views were rendered from exactly the same perspective (left: initial triangulation, right: after optimization):

![Top view comparison, before and after optimization](/sample/initial_vs_optimized1.png)

Setup Notes
-----------
The C++ implementation should work cross-platform, but I've configured CMakeLists.txt for Windows.

 1. Download and install Visual Studio 2019
 2. Follow the instructions [here](https://docs.opencv.org/master/d3/d52/tutorial_windows_install.html) to build OpenCV 4.5.3 from source, but change the script to use generator "Visual Studio 16 2019".
 3. Download the half-resolution 2014 dataset from the [Middlebury Stereo Evaluation](https://vision.middlebury.edu/stereo/submit3/) page, and extract into this folder.
 4. Create a `build` folder here and run `cmake . -B build`
 5. Run `cmake --build build --config Release --target ALL_BUILD -j 10 --`
 6. Find `opencv_world453.dll` in the OpenCV build folder and copy it into `build/Release/`

After running the program, I recommend using [CloudCompare](https://www.danielgm.net/cc/) to view the generated point clouds.
